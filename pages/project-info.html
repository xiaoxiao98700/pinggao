<!-- æ ‡ç­¾é¡µ -->
<div class="tabs">
    <div class="tab active">
        çº¿ç´¢ç®¡ç† <span class="tab-badge">å¸‚åœºéƒ¨</span>
        <span class="tab-close">Ã—</span>
    </div>
</div>

<!-- å¸‚åœºéƒ¨å·¥ä½œå° -->
<div class="project-info-wrapper">
    <div class="dept-header">
        <h2 class="dept-title">ğŸ¯ å¸‚åœºéƒ¨ - çº¿ç´¢ç®¡ç†</h2>
        <p class="dept-desc">ç®¡ç†é¡¹ç›®çº¿ç´¢å’Œå•†æœºï¼Œæ¨è¿›ç­¾çº¦æµç¨‹</p>
    </div>
    
    <!-- æœç´¢ç­›é€‰åŒºåŸŸ -->
    <div class="search-section">
        <div class="search-filters">
            <div class="filter-item">
                <label>é¡¹ç›®åç§°</label>
                <input type="text" placeholder="è¾“å…¥é¡¹ç›®åç§°" class="filter-input" id="filterProjectName">
            </div>
            <div class="filter-item">
                <label>å®¢æˆ·åç§°</label>
                <input type="text" placeholder="è¾“å…¥å®¢æˆ·åç§°" class="filter-input" id="filterCustomerName">
            </div>
            <div class="filter-item">
                <label>é˜¶æ®µ</label>
                <select class="filter-input" id="filterStage">
                    <option value="">å…¨éƒ¨</option>
                    <option value="å¸‚åœºçº¿ç´¢">å¸‚åœºçº¿ç´¢</option>
                    <option value="å•†æœºè·Ÿè¿›">å•†æœºè·Ÿè¿›</option>
                </select>
            </div>
            <div class="filter-item">
                <label>å¸‚åœºäººå‘˜</label>
                <input type="text" placeholder="è¾“å…¥å¸‚åœºäººå‘˜" class="filter-input" id="filterSalesman">
            </div>
            <div class="filter-item">
                <label>ä¼˜å…ˆçº§</label>
                <select class="filter-input" id="filterPriority">
                    <option value="">å…¨éƒ¨</option>
                    <option value="é«˜">é«˜</option>
                    <option value="ä¸­">ä¸­</option>
                    <option value="ä½">ä½</option>
                </select>
            </div>
        </div>
        <div class="search-actions">
            <button class="btn-query" onclick="queryProjects()">QæŸ¥è¯¢</button>
            <button class="btn-reset" onclick="resetFilters()">Cé‡ç½®</button>
            <button class="btn-expand" onclick="toggleFilters()">å±•å¼€</button>
        </div>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-cards">
        <div class="stat-card stat-card-lead">
            <div class="stat-icon">ğŸ“‹</div>
            <div class="stat-content">
                <div class="stat-value">23</div>
                <div class="stat-label">å¸‚åœºçº¿ç´¢</div>
            </div>
        </div>
        <div class="stat-card stat-card-opportunity">
            <div class="stat-icon">ğŸ’¼</div>
            <div class="stat-content">
                <div class="stat-value">12</div>
                <div class="stat-label">å•†æœºè·Ÿè¿›</div>
            </div>
        </div>
        <div class="stat-card stat-card-signed">
            <div class="stat-icon">âœ…</div>
            <div class="stat-content">
                <div class="stat-value">8</div>
                <div class="stat-label">æœ¬æœˆç­¾çº¦</div>
            </div>
        </div>
        <div class="stat-card stat-card-target">
            <div class="stat-icon">ğŸ¯</div>
            <div class="stat-content">
                <div class="stat-value">67%</div>
                <div class="stat-label">ç­¾çº¦è½¬åŒ–ç‡</div>
            </div>
        </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="table-actions">
        <a href="pages/add-project.html" onclick="event.preventDefault(); window.loadPage('pages/add-project.html'); return false;" class="btn-add">+ æ–°å¢çº¿ç´¢</a>
        <button class="btn-delete" onclick="batchDeleteProjects()">åˆ é™¤</button>
        <button class="btn-export" onclick="exportProjects()">å¯¼å‡º</button>
    </div>

    <!-- æ•°æ®è¡¨æ ¼ -->
    <div class="table-container">
        <table class="data-table project-list-table" id="projectTable">
            <thead>
                <tr>
                    <th><input type="checkbox" class="select-all" onclick="toggleSelectAll(this)"></th>
                    <th>åºå·</th>
                    <th>é¡¹ç›®ç¼–å·</th>
                    <th>é¡¹ç›®åç§°</th>
                    <th>å®¢æˆ·åç§°</th>
                    <th>é¡¹ç›®æ‰€åœ¨åœ°</th>
                    <th>å¸‚åœºäººå‘˜</th>
                    <th>ä¼˜å…ˆçº§</th>
                    <th>é˜¶æ®µ</th>
                    <th>é¢„è®¡ç­¾çº¦</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                <!-- å¸‚åœºçº¿ç´¢ -->
                <tr data-id="1" data-stage="å¸‚åœºçº¿ç´¢">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>1</td>
                    <td>PL2025-11-2601</td>
                    <td>éƒ‘å·é«˜æ–°åŒºæ–°èƒ½æºå‘ç”µé¡¹ç›®</td>
                    <td>æ²™ä¿„æœ‰é™å…¬å¸</td>
                    <td>æ²³å—çœéƒ‘å·å¸‚</td>
                    <td>ææ˜</td>
                    <td><span class="priority-badge priority-high">é«˜</span></td>
                    <td><span class="status-badge status-lead">å¸‚åœºçº¿ç´¢</span></td>
                    <td>2025-12</td>
                    <td>2025-11-26</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectDetail(1); return false;">è¯¦æƒ…</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 1}); return false;" class="action-link">ç¼–è¾‘</a>
                        <a href="#" class="action-link action-primary" onclick="updateToOpportunity(1); return false;">è½¬å•†æœº</a>
                    </td>
                </tr>
                
                <tr data-id="2" data-stage="å¸‚åœºçº¿ç´¢">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>2</td>
                    <td>PL2025-11-2501</td>
                    <td>æ–°ä¹¡åŒ–å·¥å›­åŒºæ™ºèƒ½é…ç”µç³»ç»Ÿ</td>
                    <td>æ–°ä¹¡åŒ–å·¥é›†å›¢</td>
                    <td>æ²³å—çœæ–°ä¹¡å¸‚</td>
                    <td>ç‹èŠ³</td>
                    <td><span class="priority-badge priority-medium">ä¸­</span></td>
                    <td><span class="status-badge status-lead">å¸‚åœºçº¿ç´¢</span></td>
                    <td>2026-01</td>
                    <td>2025-11-25</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectDetail(2); return false;">è¯¦æƒ…</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 2}); return false;" class="action-link">ç¼–è¾‘</a>
                        <a href="#" class="action-link action-primary" onclick="updateToOpportunity(2); return false;">è½¬å•†æœº</a>
                    </td>
                </tr>
                
                <!-- å•†æœºè·Ÿè¿› -->
                <tr data-id="3" data-stage="å•†æœºè·Ÿè¿›">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>3</td>
                    <td>PL2025-11-2001</td>
                    <td>æ­£å¤§åŒ–å·¥å›­åŒºé…ç”µæ”¹é€ é¡¹ç›®</td>
                    <td>æ­£å¤§åŒ–å·¥æœ‰é™å…¬å¸</td>
                    <td>æ²³å—çœæ–°ä¹¡å¸‚</td>
                    <td>å¼ ä¼Ÿ</td>
                    <td><span class="priority-badge priority-high">é«˜</span></td>
                    <td><span class="status-badge status-opportunity">å•†æœºè·Ÿè¿›</span></td>
                    <td>2025-12</td>
                    <td>2025-11-20</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectDetail(3); return false;">è¯¦æƒ…</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 3}); return false;" class="action-link">ç¼–è¾‘</a>
                        <a href="#" class="action-link action-success" onclick="openSignContractModal(3); return false;">ç­¾çº¦</a>
                    </td>
                </tr>
                
                <tr data-id="4" data-stage="å•†æœºè·Ÿè¿›">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>4</td>
                    <td>PL2025-11-1801</td>
                    <td>æ­¦æ±‰è¿ˆç‘åŒ»ç–—è®¾å¤‡ä¾›ç”µé¡¹ç›®</td>
                    <td>æ­¦æ±‰è¿ˆç‘åŒ»ç–—è®¾å¤‡æœ‰é™å…¬å¸</td>
                    <td>æ¹–åŒ—çœæ­¦æ±‰å¸‚</td>
                    <td>åˆ˜é™</td>
                    <td><span class="priority-badge priority-high">é«˜</span></td>
                    <td><span class="status-badge status-opportunity">å•†æœºè·Ÿè¿›</span></td>
                    <td>2025-12</td>
                    <td>2025-11-18</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectDetail(4); return false;">è¯¦æƒ…</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 4}); return false;" class="action-link">ç¼–è¾‘</a>
                        <a href="#" class="action-link action-success" onclick="openSignContractModal(4); return false;">ç­¾çº¦</a>
                    </td>
                </tr>
                
                <tr data-id="5" data-stage="å•†æœºè·Ÿè¿›">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>5</td>
                    <td>PL2025-11-1501</td>
                    <td>å¹³é¡¶å±±å°¼é¾™äº§ä¸šå›­é…ç”µå·¥ç¨‹</td>
                    <td>å¹³é¡¶å±±å°¼é¾™äº§ä¸šå›­ç®¡ç†æœ‰é™å…¬å¸</td>
                    <td>æ²³å—çœå¹³é¡¶å±±å¸‚</td>
                    <td>å­™ä¼Ÿ</td>
                    <td><span class="priority-badge priority-medium">ä¸­</span></td>
                    <td><span class="status-badge status-opportunity">å•†æœºè·Ÿè¿›</span></td>
                    <td>2026-01</td>
                    <td>2025-11-15</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectDetail(5); return false;">è¯¦æƒ…</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 5}); return false;" class="action-link">ç¼–è¾‘</a>
                        <a href="#" class="action-link action-success" onclick="openSignContractModal(5); return false;">ç­¾çº¦</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination">
        <div class="pagination-info">
            <span>å…±35æ¡çº¿ç´¢/å•†æœº</span>
        </div>
        <div class="pagination-controls">
            <select class="page-size">
                <option value="20" selected>20æ¡/é¡µ</option>
                <option value="50">50æ¡/é¡µ</option>
                <option value="100">100æ¡/é¡µ</option>
            </select>
            <div class="page-nav">
                <button class="page-btn" disabled><</button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">></button>
            </div>
            <div class="page-jump">
                <span>å‰å¾€</span>
                <input type="number" class="page-input" value="1" min="1">
                <span>é¡µ</span>
            </div>
        </div>
    </div>
</div>

<!-- é¡¹ç›®è¯¦æƒ…å¼¹çª— -->
<div class="modal-overlay" id="projectDetailModal" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1">
    <div class="modal-content modal-detail-content">
        <div class="modal-header">
            <h3 class="modal-title">é¡¹ç›®è¯¦æƒ…</h3>
            <button type="button" class="modal-close" aria-label="å…³é—­">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="modal-loading">å‡†å¤‡åŠ è½½é¡¹ç›®è¯¦æƒ…â€¦</div>
        </div>
    </div>
</div>

<!-- ç­¾çº¦ç§»äº¤å¼¹çª— - å¸‚åœºéƒ¨å¡«å†™åç§»äº¤ç»™é¡¹ç›®éƒ¨ -->
<div class="modal-overlay" id="signContractModal" role="dialog" aria-modal="true" tabindex="-1" style="display:none;">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3 class="modal-title">ğŸ¤ é¡¹ç›®ç­¾çº¦ç§»äº¤</h3>
            <button class="modal-close" type="button">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="form-header-tip">
                <span class="tip-icon">â„¹ï¸</span>
                <span class="tip-text">è¯·å¡«å†™ç­¾çº¦åŸºæœ¬ä¿¡æ¯ï¼Œé¡¹ç›®å°†ç§»äº¤ç»™<strong>é¡¹ç›®éƒ¨</strong>è¿›è¡Œåç»­ç®¡ç†ï¼ˆåˆ†é…é¡¹ç›®è´Ÿè´£äººã€è¯¦ç»†åˆåŒä¿¡æ¯ç­‰ï¼‰</span>
            </div>
            
            <form id="signContractForm">
                <div class="form-section-title">é¡¹ç›®åŸºæœ¬ä¿¡æ¯</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>é¡¹ç›®ç¼–å·</label>
                        <input type="text" class="modal-input" id="signProjectNumber" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®åç§°</label>
                        <input type="text" class="modal-input" id="signProjectName" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>å®¢æˆ·åç§°</label>
                        <input type="text" class="modal-input" id="signCustomerName" readonly style="background-color:#f5f5f5;">
                    </div>
                </div>
                
                <div class="form-section-title">åˆåŒåŸºæœ¬ä¿¡æ¯<span class="required">*</span></div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ç­¾è®¢æ—¶é—´<span class="required">*</span></label>
                        <input type="date" class="modal-input" id="signDate" required>
                    </div>
                    <div class="form-group">
                        <label>åˆåŒç±»å‹<span class="required">*</span></label>
                        <select class="modal-input" id="contractType" required>
                            <option value="">è¯·é€‰æ‹©åˆåŒç±»å‹</option>
                            <option value="æ¡†æ¶åˆåŒ">æ¡†æ¶åˆåŒ</option>
                            <option value="è®¾å¤‡é‡‡è´­åˆåŒ">è®¾å¤‡é‡‡è´­åˆåŒ</option>
                            <option value="å·¥ç¨‹æ–½å·¥åˆåŒ">å·¥ç¨‹æ–½å·¥åˆåŒ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>åˆåŒé‡‘é¢ï¼ˆä¸‡å…ƒï¼‰<span class="required">*</span></label>
                        <input type="number" step="0.01" class="modal-input" id="contractAmount" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ç­¾è®¢ä¸»ä½“<span class="required">*</span></label>
                        <input type="text" class="modal-input" id="signEntity" placeholder="å¦‚ï¼šæ²³å—å¹³é«˜ç”µæ°”è‚¡ä»½æœ‰é™å…¬å¸" required>
                    </div>
                    <div class="form-group">
                        <label>åˆåŒäº¤è´§æœŸ<span class="required">*</span></label>
                        <input type="date" class="modal-input" id="contractDelivery" required>
                    </div>
                    <div class="form-group">
                        <label>åˆåŒå®Œå·¥æœŸ<span class="required">*</span></label>
                        <input type="date" class="modal-input" id="contractCompletion" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>è´¨ä¿æœŸ<span class="required">*</span></label>
                        <input type="text" class="modal-input" id="warrantyPeriod" placeholder="å¦‚ï¼š2å¹´" required>
                    </div>
                </div>
                
                <div class="form-section-title">äº§å“ä¿¡æ¯<span class="required">*</span></div>
                <div class="form-row">
                    <div class="form-group">
                        <label>äº§å“åç§°<span class="required">*</span></label>
                        <input type="text" class="modal-input" id="productName" placeholder="è¯·è¾“å…¥äº§å“åç§°" required>
                    </div>
                    <div class="form-group">
                        <label>äº§å“ç¼–ç <span class="required">*</span></label>
                        <input type="text" class="modal-input" id="productCode" placeholder="è¯·è¾“å…¥äº§å“ç¼–ç " required>
                    </div>
                    <div class="form-group">
                        <label>äº§å“å‹å·<span class="required">*</span></label>
                        <input type="text" class="modal-input" id="productModel" placeholder="å¦‚ï¼šEP-100" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>é¢å®šåŠŸç‡ MW<span class="required">*</span></label>
                        <input type="number" step="0.01" class="modal-input" id="ratedPower" placeholder="è¯·è¾“å…¥é¢å®šåŠŸç‡" required>
                    </div>
                    <div class="form-group">
                        <label>è¿è¡Œï¼ˆåˆåŒï¼‰åŠŸç‡ MW<span class="required">*</span></label>
                        <input type="number" step="0.01" class="modal-input" id="operatingPower" placeholder="è¯·è¾“å…¥è¿è¡ŒåŠŸç‡" required>
                    </div>
                    <div class="form-group">
                        <label>æ•°é‡<span class="required">*</span></label>
                        <input type="number" class="modal-input" id="quantity" placeholder="è¯·è¾“å…¥æ•°é‡" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>ç­¾çº¦å¤‡æ³¨</label>
                        <textarea class="modal-input" id="signRemark" rows="2" placeholder="è¯·è¾“å…¥ç­¾çº¦ç›¸å…³å¤‡æ³¨ï¼Œå¦‚ç‰¹æ®Šæ¡æ¬¾ã€æ³¨æ„äº‹é¡¹ç­‰"></textarea>
                    </div>
                </div>
                
                <div class="form-footer-tip">
                    <span class="tip-icon">ğŸ’¡</span>
                    <span class="tip-text">ç¡®è®¤ç­¾çº¦åï¼Œé¡¹ç›®å°†è½¬ä¸º<strong>PEç¼–å·</strong>ï¼ˆProject Executionï¼‰ï¼Œå¹¶ç§»äº¤åˆ°<strong>é¡¹ç›®éƒ¨-åˆåŒä¿¡æ¯</strong>é¡µé¢ï¼Œç”±é¡¹ç›®éƒ¨åˆ†é…é¡¹ç›®è´Ÿè´£äººå¹¶å®Œå–„åˆåŒè¯¦ç»†ä¿¡æ¯</span>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-cancel">å–æ¶ˆ</button>
            <button type="button" class="modal-btn modal-btn-confirm">ç¡®è®¤ç­¾çº¦å¹¶ç§»äº¤</button>
        </div>
    </div>
</div>

<script>
// å¸‚åœºéƒ¨å·¥ä½œå°åŠŸèƒ½
(function() {
    'use strict';
    
    window.queryProjects = function() {
        alert('æŸ¥è¯¢åŠŸèƒ½å¼€å‘ä¸­...');
    };
    
    window.resetFilters = function() {
        document.getElementById('filterProjectName').value = '';
        document.getElementById('filterCustomerName').value = '';
        document.getElementById('filterStage').value = '';
        document.getElementById('filterSalesman').value = '';
        document.getElementById('filterPriority').value = '';
    };
    
    window.toggleFilters = function() {
        const filters = document.querySelector('.search-filters');
        filters?.classList.toggle('expanded');
    };
    
    window.toggleSelectAll = function(checkbox) {
        const checkboxes = document.querySelectorAll('.row-checkbox');
        checkboxes.forEach(cb => cb.checked = checkbox.checked);
    };
    
    window.batchDeleteProjects = function() {
        const checked = document.querySelectorAll('.row-checkbox:checked');
        if (checked.length === 0) {
            alert('è¯·é€‰æ‹©è¦åˆ é™¤çš„é¡¹ç›®');
            return;
        }
        if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${checked.length} ä¸ªé¡¹ç›®çº¿ç´¢å—ï¼Ÿ`)) {
            alert('åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...');
        }
    };
    
    window.exportProjects = function() {
        alert('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
    };
    
    window.viewProjectDetail = function(id) {
        console.log('æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…ï¼š', id);
        if (typeof openProjectDetailModal === 'function') {
            const row = document.querySelector(`tr[data-id="${id}"]`);
            const detailLink = row?.querySelector('.action-link');
            if (detailLink) {
                detailLink.setAttribute('data-detail-page', 'pages/detail-project.html');
                openProjectDetailModal(detailLink);
            }
        }
    };
    
    // è½¬ä¸ºå•†æœº
    window.updateToOpportunity = function(id) {
        if (confirm('ç¡®å®šè¦å°†æ­¤çº¿ç´¢è½¬ä¸º"å•†æœºè·Ÿè¿›"é˜¶æ®µå—ï¼Ÿ')) {
            console.log('è½¬ä¸ºå•†æœºï¼š', id);
            alert('å·²è½¬ä¸ºå•†æœºè·Ÿè¿›ï¼');
            const row = document.querySelector(`tr[data-id="${id}"]`);
            if (row) {
                row.cells[8].innerHTML = '<span class="status-badge status-opportunity">å•†æœºè·Ÿè¿›</span>';
                row.setAttribute('data-stage', 'å•†æœºè·Ÿè¿›');
            }
        }
    };
    
    // æ‰“å¼€ç­¾çº¦ç§»äº¤å¼¹çª—
    window.openSignContractModal = function(id) {
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return;
        
        const modal = document.getElementById('signContractModal');
        if (!modal) return;
        
        document.getElementById('signProjectNumber').value = row.cells[2]?.textContent || '';
        document.getElementById('signProjectName').value = row.cells[3]?.textContent || '';
        document.getElementById('signCustomerName').value = row.cells[4]?.textContent || '';
        
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('signDate').value = today;
        
        modal.dataset.projectId = id;
        modal.style.display = 'flex';
    };
    
    // å¼¹çª—å…³é—­äº‹ä»¶
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal-close') || e.target.classList.contains('modal-overlay')) {
            const modal = e.target.closest('.modal-overlay') || e.target;
            if (modal && modal.classList.contains('modal-overlay')) {
                modal.style.display = 'none';
            }
        }
        
        if (e.target.classList.contains('modal-btn-confirm')) {
            const modal = e.target.closest('.modal-overlay');
            if (modal && modal.id === 'signContractModal') {
                saveSignContract();
            }
        }
        
        if (e.target.classList.contains('modal-btn-cancel')) {
            const modal = e.target.closest('.modal-overlay');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    });
    
    // ä¿å­˜ç­¾çº¦ä¿¡æ¯å¹¶ç§»äº¤ç»™é¡¹ç›®éƒ¨
    function saveSignContract() {
        const modal = document.getElementById('signContractModal');
        const projectId = modal?.dataset.projectId;
        
        const formData = {
            projectId: projectId,
            // åˆåŒåŸºæœ¬ä¿¡æ¯
            signDate: document.getElementById('signDate')?.value,
            contractType: document.getElementById('contractType')?.value,
            contractAmount: document.getElementById('contractAmount')?.value,
            signEntity: document.getElementById('signEntity')?.value,
            contractDelivery: document.getElementById('contractDelivery')?.value,
            contractCompletion: document.getElementById('contractCompletion')?.value,
            warrantyPeriod: document.getElementById('warrantyPeriod')?.value,
            // äº§å“ä¿¡æ¯
            productName: document.getElementById('productName')?.value,
            productCode: document.getElementById('productCode')?.value,
            productModel: document.getElementById('productModel')?.value,
            ratedPower: document.getElementById('ratedPower')?.value,
            operatingPower: document.getElementById('operatingPower')?.value,
            quantity: document.getElementById('quantity')?.value,
            signRemark: document.getElementById('signRemark')?.value
        };
        
        // éªŒè¯æ‰€æœ‰å¿…å¡«é¡¹
        if (!formData.signDate || !formData.contractType || !formData.contractAmount || 
            !formData.signEntity || !formData.contractDelivery || !formData.contractCompletion || 
            !formData.warrantyPeriod || !formData.productName || !formData.productCode || 
            !formData.productModel || !formData.ratedPower || !formData.operatingPower || 
            !formData.quantity) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼ˆæ ‡æ³¨*å·çš„å­—æ®µï¼‰');
            return;
        }
        
        console.log('ç­¾çº¦å¹¶ç§»äº¤ï¼š', formData);
        
        alert('âœ… ç­¾çº¦æˆåŠŸï¼\n\n' +
              'é¡¹ç›®å·²ç§»äº¤ç»™é¡¹ç›®éƒ¨\n' +
              'é¡¹ç›®ç¼–å·å·²æ›´æ–°ä¸ºï¼šPE' + formData.projectId + '\n\n' +
              'åˆåŒä¿¡æ¯å·²è®°å½•ï¼š\n' +
              '- åˆåŒé‡‘é¢ï¼š' + formData.contractAmount + 'ä¸‡å…ƒ\n' +
              '- äº§å“å‹å·ï¼š' + formData.productModel + '\n' +
              '- è´¨ä¿æœŸï¼š' + formData.warrantyPeriod + '\n\n' +
              'é¡¹ç›®éƒ¨å°†è´Ÿè´£åˆ†é…é¡¹ç›®è´Ÿè´£äººå’Œé¡¹ç›®æ—¶é—´');
        
        modal.style.display = 'none';
        
        // ä»å¸‚åœºéƒ¨é¡µé¢ç§»é™¤è¯¥é¡¹ç›®
        const row = document.querySelector(`tr[data-id="${projectId}"]`);
        if (row) {
            row.remove();
        }
    }
})();
</script>
