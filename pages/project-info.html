<!-- 标签页 -->
<div class="tabs">
    <div class="tab active">
        项目信息
        <span class="tab-close">×</span>
    </div>
</div>

<!-- 项目列表区域 -->
<div class="project-info-wrapper">
    <!-- 搜索筛选区域 -->
    <div class="search-section">
        <div class="search-filters">
            <div class="filter-item">
                <label>项目名称</label>
                <input type="text" placeholder="输入项目名称" class="filter-input" id="filterProjectName">
            </div>
            <div class="filter-item">
                <label>客户名称</label>
                <input type="text" placeholder="输入客户名称" class="filter-input" id="filterCustomerName">
            </div>
            <div class="filter-item">
                <label>项目状态</label>
                <select class="filter-input" id="filterProjectStatus">
                    <option value="">全部状态</option>
                    <option value="未签约">未签约</option>
                    <option value="已签约">已签约</option>
                    <option value="实施中">实施中</option>
                    <option value="已完工">已完工</option>
                    <option value="已验收">已验收</option>
                </select>
            </div>
            <div class="filter-item">
                <label>项目负责人</label>
                <input type="text" placeholder="输入项目负责人" class="filter-input" id="filterManager">
            </div>
        </div>
        <div class="search-actions">
            <button class="btn-query" onclick="queryProjects()">Q查询</button>
            <button class="btn-reset" onclick="resetFilters()">C重置</button>
            <button class="btn-expand" onclick="toggleFilters()">展开</button>
        </div>
    </div>

    <!-- 操作按钮 -->
    <div class="table-actions">
        <a href="pages/add-project.html" onclick="event.preventDefault(); window.loadPage('pages/add-project.html'); return false;" class="btn-add">+ 新增项目</a>
        <button class="btn-delete" onclick="batchDeleteProjects()">删除</button>
        <button class="btn-export" onclick="exportProjects()">导出</button>
    </div>

    <!-- 数据表格 -->
    <div class="table-container">
        <table class="data-table project-list-table" id="projectTable">
            <thead>
                <tr>
                    <th><input type="checkbox" class="select-all" onclick="toggleSelectAll(this)"></th>
                    <th>序号</th>
                    <th>项目编号</th>
                    <th>项目名称</th>
                    <th>客户名称</th>
                    <th>项目所在地</th>
                    <th>项目负责人</th>
                    <th>联系方式</th>
                    <th>项目状态</th>
                    <th>合同状态</th>
                    <th>实施状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr data-id="1">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>1</td>
                    <td>PE2025-09-2607</td>
                    <td>郑州高新区新能源发电项目</td>
                    <td>沙俄有限公司</td>
                    <td>河南省郑州市</td>
                    <td>刘静</td>
                    <td>13700137000</td>
                    <td><span class="status-badge status-unsigned">未签约</span></td>
                    <td><span class="status-badge status-pending">待签订</span></td>
                    <td><span class="status-badge status-notstart">未开始</span></td>
                    <td class="actions">
                        <a href="#" class="action-link action-detail" onclick="viewProjectDetail(1); return false;">详情</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 1}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="signContract(1); return false;">签约</a>
                    </td>
                </tr>
                <tr data-id="2">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>2</td>
                    <td>PE2025-09-2606</td>
                    <td>正大化工园区配电改造项目</td>
                    <td>正大化工有限公司</td>
                    <td>河南省新乡市</td>
                    <td>王明</td>
                    <td>13900139000</td>
                    <td><span class="status-badge status-signed">已签约</span></td>
                    <td><span class="status-badge status-complete">已签订</span></td>
                    <td><span class="status-badge status-implementation">实施中</span></td>
                    <td class="actions">
                        <a href="#" class="action-link action-detail" onclick="viewProjectDetail(2); return false;">详情</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 2}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="editContract(2); return false;">合同信息</a>
                        <a href="#" class="action-link" onclick="editImplementation(2); return false;">实施信息</a>
                    </td>
                </tr>
                <tr data-id="3">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>3</td>
                    <td>PE2025-09-2605</td>
                    <td>新疆昌吉风电场并网项目</td>
                    <td>新疆昌吉新能源有限公司</td>
                    <td>新疆昌吉州</td>
                    <td>赵强</td>
                    <td>15000150000</td>
                    <td><span class="status-badge status-signed">已签约</span></td>
                    <td><span class="status-badge status-complete">已签订</span></td>
                    <td><span class="status-badge status-acceptance">已验收</span></td>
                    <td class="actions">
                        <a href="#" class="action-link action-detail" onclick="viewProjectDetail(3); return false;">详情</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 3}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="viewContract(3); return false;">合同详情</a>
                        <a href="#" class="action-link" onclick="viewImplementation(3); return false;">实施详情</a>
                    </td>
                </tr>
                <tr data-id="4">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>4</td>
                    <td>PE2025-09-2604</td>
                    <td>武汉迈瑞医疗设备供电项目</td>
                    <td>武汉迈瑞医疗设备有限公司</td>
                    <td>湖北省武汉市</td>
                    <td>刘静</td>
                    <td>13600136000</td>
                    <td><span class="status-badge status-signed">已签约</span></td>
                    <td><span class="status-badge status-complete">已签订</span></td>
                    <td><span class="status-badge status-complete">已完工</span></td>
                    <td class="actions">
                        <a href="#" class="action-link action-detail" onclick="viewProjectDetail(4); return false;">详情</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 4}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="viewContract(4); return false;">合同详情</a>
                        <a href="#" class="action-link" onclick="editImplementation(4); return false;">实施信息</a>
                    </td>
                </tr>
                <tr data-id="5">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>5</td>
                    <td>PE2025-09-2603</td>
                    <td>平顶山尼龙产业园配电工程</td>
                    <td>平顶山尼龙产业园管理有限公司</td>
                    <td>河南省平顶山市</td>
                    <td>孙伟</td>
                    <td>13700137000</td>
                    <td><span class="status-badge status-unsigned">未签约</span></td>
                    <td><span class="status-badge status-pending">待签订</span></td>
                    <td><span class="status-badge status-notstart">未开始</span></td>
                    <td class="actions">
                        <a href="#" class="action-link action-detail" onclick="viewProjectDetail(5); return false;">详情</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 5}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="signContract(5); return false;">签约</a>
                    </td>
                </tr>
                <tr data-id="6">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>6</td>
                    <td>PE2025-09-2602</td>
                    <td>沙俄有限公司生产基地供电项目</td>
                    <td>沙俄有限公司</td>
                    <td>河南省平顶山市</td>
                    <td>刘静</td>
                    <td>13700137000</td>
                    <td><span class="status-badge status-signed">已签约</span></td>
                    <td><span class="status-badge status-complete">已签订</span></td>
                    <td><span class="status-badge status-implementation">实施中</span></td>
                    <td class="actions">
                        <a href="#" class="action-link action-detail" onclick="viewProjectDetail(6); return false;">详情</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 6}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="editContract(6); return false;">合同信息</a>
                        <a href="#" class="action-link" onclick="editImplementation(6); return false;">实施信息</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 分页 -->
    <div class="pagination">
        <div class="pagination-info">
            <span>共47条</span>
        </div>
        <div class="pagination-controls">
            <select class="page-size">
                <option value="20" selected>20条/页</option>
                <option value="50">50条/页</option>
                <option value="100">100条/页</option>
            </select>
            <div class="page-nav">
                <button class="page-btn" disabled><</button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <button class="page-btn">></button>
            </div>
            <div class="page-jump">
                <span>前往</span>
                <input type="number" class="page-input" value="1" min="1">
                <span>页</span>
            </div>
        </div>
    </div>
</div>

<!-- 项目详情弹窗 -->
<div class="modal-overlay" id="projectDetailModal" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1">
    <div class="modal-content modal-detail-content">
        <div class="modal-header">
            <h3 class="modal-title">项目详情</h3>
            <button type="button" class="modal-close" aria-label="关闭">×</button>
        </div>
        <div class="modal-body">
            <div class="modal-loading">准备加载项目详情…</div>
        </div>
    </div>
</div>

<!-- 合同信息补充弹窗 -->
<div class="modal-overlay" id="contractEditModal" role="dialog" aria-modal="true" tabindex="-1" style="display:none;">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3 class="modal-title">合同信息补充</h3>
            <button class="modal-close" type="button">×</button>
        </div>
        <div class="modal-body">
            <form id="contractEditForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>项目编号</label>
                        <input type="text" class="modal-input" id="contractProjectNumber" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>项目名称</label>
                        <input type="text" class="modal-input" id="contractProjectName" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>客户名称</label>
                        <input type="text" class="modal-input" id="contractCustomerName" readonly style="background-color:#f5f5f5;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>签订时间<span class="required">*</span></label>
                        <input type="date" class="modal-input" id="signDate" required>
                    </div>
                    <div class="form-group">
                        <label>合同类型<span class="required">*</span></label>
                        <select class="modal-input" id="contractType" required>
                            <option value="">请选择合同类型</option>
                            <option value="框架合同">框架合同</option>
                            <option value="设备采购合同">设备采购合同</option>
                            <option value="工程施工合同">工程施工合同</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>合同金额（万元）<span class="required">*</span></label>
                        <input type="number" step="0.01" class="modal-input" id="contractAmount" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>额定功率 MW</label>
                        <input type="number" step="0.01" class="modal-input" id="ratedPower">
                    </div>
                    <div class="form-group">
                        <label>运行（合同）功率 MW</label>
                        <input type="number" step="0.01" class="modal-input" id="operatingPower">
                    </div>
                    <div class="form-group">
                        <label>数量</label>
                        <input type="number" class="modal-input" id="quantity">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>产品型号</label>
                        <input type="text" class="modal-input" id="productModel">
                    </div>
                    <div class="form-group">
                        <label>产品编号</label>
                        <input type="text" class="modal-input" id="productNumber">
                    </div>
                    <div class="form-group">
                        <label>签订主体</label>
                        <input type="text" class="modal-input" id="signEntity" placeholder="如：河南平高电气股份有限公司">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>合同交货期</label>
                        <input type="date" class="modal-input" id="contractDelivery">
                    </div>
                    <div class="form-group">
                        <label>实际交货期</label>
                        <input type="date" class="modal-input" id="actualDelivery">
                    </div>
                    <div class="form-group">
                        <label>是否交货</label>
                        <select class="modal-input" id="isDelivered">
                            <option value="">请选择</option>
                            <option value="是">是</option>
                            <option value="否">否</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>合同完工时间</label>
                        <input type="date" class="modal-input" id="completionDate">
                    </div>
                    <div class="form-group">
                        <label>销售负责人</label>
                        <input type="text" class="modal-input" id="salesManager">
                    </div>
                    <div class="form-group">
                        <label>联系电话</label>
                        <input type="text" class="modal-input" id="salesPhone">
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-cancel">取消</button>
            <button type="button" class="modal-btn modal-btn-confirm">确定</button>
        </div>
    </div>
</div>

<!-- 实施信息补充弹窗 -->
<div class="modal-overlay" id="implementationEditModal" role="dialog" aria-modal="true" tabindex="-1" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 class="modal-title">实施信息补充</h3>
            <button class="modal-close" type="button">×</button>
        </div>
        <div class="modal-body">
            <form id="implementationEditForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>项目编号</label>
                        <input type="text" class="modal-input" id="implProjectNumber" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>项目名称</label>
                        <input type="text" class="modal-input" id="implProjectName" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>客户名称</label>
                        <input type="text" class="modal-input" id="implCustomerName" readonly style="background-color:#f5f5f5;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>实际开工时间</label>
                        <input type="date" class="modal-input" id="actualStartDate">
                    </div>
                    <div class="form-group">
                        <label>实际完工时间</label>
                        <input type="date" class="modal-input" id="actualEndDate">
                    </div>
                    <div class="form-group">
                        <label>实施负责人</label>
                        <input type="text" class="modal-input" id="implManager">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>验收时间</label>
                        <input type="date" class="modal-input" id="acceptanceDate">
                    </div>
                    <div class="form-group">
                        <label>是否验收</label>
                        <select class="modal-input" id="isAccepted">
                            <option value="">请选择</option>
                            <option value="是">是</option>
                            <option value="否">否</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>质保期</label>
                        <input type="text" class="modal-input" id="warrantyPeriod" placeholder="如：1年">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>实施备注</label>
                        <textarea class="modal-input" id="implRemark" rows="3" placeholder="请输入实施备注信息"></textarea>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-cancel">取消</button>
            <button type="button" class="modal-btn modal-btn-confirm">确定</button>
        </div>
    </div>
</div>

<script>
// 项目管理相关函数
(function() {
    'use strict';
    
    // 查询项目
    window.queryProjects = function() {
        const projectName = document.getElementById('filterProjectName')?.value || '';
        const customerName = document.getElementById('filterCustomerName')?.value || '';
        const status = document.getElementById('filterProjectStatus')?.value || '';
        const manager = document.getElementById('filterManager')?.value || '';
        
        console.log('查询条件：', { projectName, customerName, status, manager });
        alert('查询功能开发中...');
    };
    
    // 重置筛选条件
    window.resetFilters = function() {
        document.getElementById('filterProjectName').value = '';
        document.getElementById('filterCustomerName').value = '';
        document.getElementById('filterProjectStatus').value = '';
        document.getElementById('filterManager').value = '';
    };
    
    // 切换筛选器展开/收起
    window.toggleFilters = function() {
        const filters = document.querySelector('.search-filters');
        filters?.classList.toggle('expanded');
    };
    
    // 全选/取消全选
    window.toggleSelectAll = function(checkbox) {
        const checkboxes = document.querySelectorAll('.row-checkbox');
        checkboxes.forEach(cb => cb.checked = checkbox.checked);
    };
    
    // 批量删除
    window.batchDeleteProjects = function() {
        const checked = document.querySelectorAll('.row-checkbox:checked');
        if (checked.length === 0) {
            alert('请选择要删除的项目');
            return;
        }
        if (confirm(`确定要删除选中的 ${checked.length} 个项目吗？`)) {
            alert('删除功能开发中...');
        }
    };
    
    // 导出项目
    window.exportProjects = function() {
        alert('导出功能开发中...');
    };
    
    // 查看项目详情
    window.viewProjectDetail = function(id) {
        console.log('查看项目详情：', id);
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return;
        
        // 获取项目信息
        const projectInfo = {
            id: id,
            number: row.cells[2]?.textContent || '',
            name: row.cells[3]?.textContent || '',
            customer: row.cells[4]?.textContent || '',
            location: row.cells[5]?.textContent || '',
            manager: row.cells[6]?.textContent || '',
            phone: row.cells[7]?.textContent || ''
        };
        
        // 调用 page-init.js 中的详情模态框函数
        if (typeof openProjectDetailModal === 'function') {
            const detailLink = row.querySelector('.action-detail');
            if (detailLink) {
                detailLink.setAttribute('data-detail-page', 'pages/detail-project.html');
                openProjectDetailModal(detailLink);
            }
        }
    };
    
    // 签约操作
    window.signContract = function(id) {
        console.log('签约项目：', id);
        if (confirm('确定要将该项目标记为已签约吗？')) {
            // 打开合同信息补充弹窗
            editContract(id);
        }
    };
    
    // 编辑合同信息
    window.editContract = function(id) {
        console.log('编辑合同信息：', id);
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return;
        
        const modal = document.getElementById('contractEditModal');
        if (!modal) return;
        
        // 填充项目基本信息
        document.getElementById('contractProjectNumber').value = row.cells[2]?.textContent || '';
        document.getElementById('contractProjectName').value = row.cells[3]?.textContent || '';
        document.getElementById('contractCustomerName').value = row.cells[4]?.textContent || '';
        
        modal.dataset.projectId = id;
        modal.style.display = 'flex';
    };
    
    // 查看合同信息
    window.viewContract = function(id) {
        console.log('查看合同信息：', id);
        alert('合同详情查看功能开发中...');
    };
    
    // 编辑实施信息
    window.editImplementation = function(id) {
        console.log('编辑实施信息：', id);
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return;
        
        const modal = document.getElementById('implementationEditModal');
        if (!modal) return;
        
        // 填充项目基本信息
        document.getElementById('implProjectNumber').value = row.cells[2]?.textContent || '';
        document.getElementById('implProjectName').value = row.cells[3]?.textContent || '';
        document.getElementById('implCustomerName').value = row.cells[4]?.textContent || '';
        
        modal.dataset.projectId = id;
        modal.style.display = 'flex';
    };
    
    // 查看实施信息
    window.viewImplementation = function(id) {
        console.log('查看实施信息：', id);
        alert('实施详情查看功能开发中...');
    };
    
    // 弹窗关闭事件
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal-close') || e.target.classList.contains('btn-cancel-modal')) {
            const modal = e.target.closest('.modal-overlay');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // 点击遮罩层关闭
        if (e.target.classList.contains('modal-overlay')) {
            e.target.style.display = 'none';
        }
        
        // 确定按钮
        if (e.target.classList.contains('modal-btn-confirm')) {
            const modal = e.target.closest('.modal-overlay');
            if (modal) {
                if (modal.id === 'contractEditModal') {
                    saveContractInfo();
                } else if (modal.id === 'implementationEditModal') {
                    saveImplementationInfo();
                }
            }
        }
        
        // 取消按钮
        if (e.target.classList.contains('modal-btn-cancel')) {
            const modal = e.target.closest('.modal-overlay');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    });
    
    // 保存合同信息
    function saveContractInfo() {
        const modal = document.getElementById('contractEditModal');
        const projectId = modal?.dataset.projectId;
        
        const formData = {
            projectId: projectId,
            signDate: document.getElementById('signDate')?.value,
            contractType: document.getElementById('contractType')?.value,
            contractAmount: document.getElementById('contractAmount')?.value,
            ratedPower: document.getElementById('ratedPower')?.value,
            operatingPower: document.getElementById('operatingPower')?.value,
            quantity: document.getElementById('quantity')?.value,
            productModel: document.getElementById('productModel')?.value,
            productNumber: document.getElementById('productNumber')?.value,
            signEntity: document.getElementById('signEntity')?.value,
            contractDelivery: document.getElementById('contractDelivery')?.value,
            actualDelivery: document.getElementById('actualDelivery')?.value,
            isDelivered: document.getElementById('isDelivered')?.value,
            completionDate: document.getElementById('completionDate')?.value,
            salesManager: document.getElementById('salesManager')?.value,
            salesPhone: document.getElementById('salesPhone')?.value
        };
        
        // 验证必填项
        if (!formData.signDate || !formData.contractType || !formData.contractAmount) {
            alert('请填写必填项：签订时间、合同类型、合同金额');
            return;
        }
        
        console.log('保存合同信息：', formData);
        alert('合同信息已保存');
        modal.style.display = 'none';
        
        // 更新项目状态为已签约
        const row = document.querySelector(`tr[data-id="${projectId}"]`);
        if (row) {
            row.cells[8].innerHTML = '<span class="status-badge status-signed">已签约</span>';
            row.cells[9].innerHTML = '<span class="status-badge status-complete">已签订</span>';
        }
    }
    
    // 保存实施信息
    function saveImplementationInfo() {
        const modal = document.getElementById('implementationEditModal');
        const projectId = modal?.dataset.projectId;
        
        const formData = {
            projectId: projectId,
            actualStartDate: document.getElementById('actualStartDate')?.value,
            actualEndDate: document.getElementById('actualEndDate')?.value,
            implManager: document.getElementById('implManager')?.value,
            acceptanceDate: document.getElementById('acceptanceDate')?.value,
            isAccepted: document.getElementById('isAccepted')?.value,
            warrantyPeriod: document.getElementById('warrantyPeriod')?.value,
            implRemark: document.getElementById('implRemark')?.value
        };
        
        console.log('保存实施信息：', formData);
        alert('实施信息已保存');
        modal.style.display = 'none';
        
        // 更新实施状态
        const row = document.querySelector(`tr[data-id="${projectId}"]`);
        if (row && formData.actualStartDate) {
            if (formData.isAccepted === '是') {
                row.cells[10].innerHTML = '<span class="status-badge status-acceptance">已验收</span>';
            } else if (formData.actualEndDate) {
                row.cells[10].innerHTML = '<span class="status-badge status-complete">已完工</span>';
            } else {
                row.cells[10].innerHTML = '<span class="status-badge status-implementation">实施中</span>';
            }
        }
    }
})();
</script>
