<!-- 标签页 -->
<div class="tabs">
    <div class="tab active">
        项目信息
        <span class="tab-close">×</span>
    </div>
</div>

<!-- 项目列表区域 -->
<div class="project-info-wrapper">
    <!-- 搜索筛选区域 -->
    <div class="search-section">
        <div class="search-filters">
            <div class="filter-item">
                <label>项目名称</label>
                <input type="text" placeholder="输入项目名称" class="filter-input" id="filterProjectName">
            </div>
            <div class="filter-item">
                <label>客户名称</label>
                <input type="text" placeholder="输入客户名称" class="filter-input" id="filterCustomerName">
            </div>
            <div class="filter-item">
                <label>项目阶段</label>
                <select class="filter-input" id="filterProjectStage">
                    <option value="">全部阶段</option>
                    <option value="市场线索">市场线索</option>
                    <option value="商机跟进">商机跟进</option>
                    <option value="已签约">已签约</option>
                    <option value="实施准备">实施准备</option>
                    <option value="实施中">实施中</option>
                    <option value="已完工">已完工</option>
                    <option value="已验收">已验收</option>
                </select>
            </div>
            <div class="filter-item">
                <label>市场人员</label>
                <input type="text" placeholder="输入市场人员" class="filter-input" id="filterSalesman">
            </div>
        </div>
        <div class="search-actions">
            <button class="btn-query" onclick="queryProjects()">Q查询</button>
            <button class="btn-reset" onclick="resetFilters()">C重置</button>
            <button class="btn-expand" onclick="toggleFilters()">展开</button>
        </div>
    </div>

    <!-- 操作按钮 -->
    <div class="table-actions">
        <a href="pages/add-project.html" onclick="event.preventDefault(); window.loadPage('pages/add-project.html'); return false;" class="btn-add">+ 新增线索</a>
        <button class="btn-delete" onclick="batchDeleteProjects()">删除</button>
        <button class="btn-export" onclick="exportProjects()">导出</button>
    </div>

    <!-- 数据表格 -->
    <div class="table-container">
        <table class="data-table project-list-table" id="projectTable">
            <thead>
                <tr>
                    <th><input type="checkbox" class="select-all" onclick="toggleSelectAll(this)"></th>
                    <th>序号</th>
                    <th>项目编号</th>
                    <th>项目名称</th>
                    <th>客户名称</th>
                    <th>项目所在地</th>
                    <th>市场人员</th>
                    <th>项目负责人</th>
                    <th>项目阶段</th>
                    <th>创建时间</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <!-- 市场线索阶段 -->
                <tr data-id="1" data-stage="市场线索">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>1</td>
                    <td>PL2025-11-2601</td>
                    <td>郑州高新区新能源发电项目</td>
                    <td>沙俄有限公司</td>
                    <td>河南省郑州市</td>
                    <td>李明</td>
                    <td>-</td>
                    <td><span class="status-badge status-lead">市场线索</span></td>
                    <td>2025-11-26</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectDetail(1); return false;">详情</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 1}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="updateStage(1, '商机跟进'); return false;">转商机</a>
                    </td>
                </tr>
                
                <!-- 商机跟进阶段 -->
                <tr data-id="2" data-stage="商机跟进">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>2</td>
                    <td>PL2025-11-2501</td>
                    <td>正大化工园区配电改造项目</td>
                    <td>正大化工有限公司</td>
                    <td>河南省新乡市</td>
                    <td>王芳</td>
                    <td>-</td>
                    <td><span class="status-badge status-opportunity">商机跟进</span></td>
                    <td>2025-11-25</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectDetail(2); return false;">详情</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 2}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="openContractModal(2); return false;">签约</a>
                    </td>
                </tr>
                
                <!-- 已签约阶段 - 有项目负责人和合同信息 -->
                <tr data-id="3" data-stage="已签约">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>3</td>
                    <td>PE2025-09-2605</td>
                    <td>新疆昌吉风电场并网项目</td>
                    <td>新疆昌吉新能源有限公司</td>
                    <td>新疆昌吉州</td>
                    <td>张伟</td>
                    <td>赵强</td>
                    <td><span class="status-badge status-signed">已签约</span></td>
                    <td>2025-09-26</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectArchive(3); return false;">档案</a>
                        <a href="pages/edit-project.html" onclick="event.preventDefault(); window.loadPage('pages/edit-project.html', {id: 3}); return false;" class="action-link">编辑</a>
                        <a href="#" class="action-link" onclick="viewContractDetail(3); return false;">合同</a>
                        <a href="#" class="action-link" onclick="assignImplementation(3); return false;">分配实施</a>
                    </td>
                </tr>
                
                <!-- 实施准备/实施中阶段 -->
                <tr data-id="4" data-stage="实施中">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>4</td>
                    <td>PE2025-09-2606</td>
                    <td>武汉迈瑞医疗设备供电项目</td>
                    <td>武汉迈瑞医疗设备有限公司</td>
                    <td>湖北省武汉市</td>
                    <td>刘静</td>
                    <td>王明</td>
                    <td><span class="status-badge status-implementation">实施中</span></td>
                    <td>2025-09-20</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectArchive(4); return false;">档案</a>
                        <a href="#" class="action-link" onclick="viewImplementationProgress(4); return false;">进度</a>
                        <a href="#" class="action-link" onclick="editImplementation(4); return false;">实施管理</a>
                    </td>
                </tr>
                
                <!-- 已完工阶段 -->
                <tr data-id="5" data-stage="已完工">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>5</td>
                    <td>PE2025-08-1501</td>
                    <td>平顶山尼龙产业园配电工程</td>
                    <td>平顶山尼龙产业园管理有限公司</td>
                    <td>河南省平顶山市</td>
                    <td>孙伟</td>
                    <td>孙伟</td>
                    <td><span class="status-badge status-complete">已完工</span></td>
                    <td>2025-08-15</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectArchive(5); return false;">档案</a>
                        <a href="#" class="action-link" onclick="viewImplementationProgress(5); return false;">进度</a>
                        <a href="#" class="action-link" onclick="openAcceptanceModal(5); return false;">验收登记</a>
                    </td>
                </tr>
                
                <!-- 已验收阶段 -->
                <tr data-id="6" data-stage="已验收">
                    <td><input type="checkbox" class="row-checkbox"></td>
                    <td>6</td>
                    <td>PE2025-07-1001</td>
                    <td>沙俄有限公司生产基地供电项目</td>
                    <td>沙俄有限公司</td>
                    <td>河南省平顶山市</td>
                    <td>刘静</td>
                    <td>刘静</td>
                    <td><span class="status-badge status-acceptance">已验收</span></td>
                    <td>2025-07-10</td>
                    <td class="actions">
                        <a href="#" class="action-link" onclick="viewProjectArchive(6); return false;">档案</a>
                        <a href="#" class="action-link" onclick="downloadAcceptanceReport(6); return false;">验收报告</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 分页 -->
    <div class="pagination">
        <div class="pagination-info">
            <span>共47条</span>
        </div>
        <div class="pagination-controls">
            <select class="page-size">
                <option value="20" selected>20条/页</option>
                <option value="50">50条/页</option>
                <option value="100">100条/页</option>
            </select>
            <div class="page-nav">
                <button class="page-btn" disabled><</button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <button class="page-btn">></button>
            </div>
            <div class="page-jump">
                <span>前往</span>
                <input type="number" class="page-input" value="1" min="1">
                <span>页</span>
            </div>
        </div>
    </div>
</div>

<!-- 项目详情弹窗 -->
<div class="modal-overlay" id="projectDetailModal" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1">
    <div class="modal-content modal-detail-content">
        <div class="modal-header">
            <h3 class="modal-title">项目详情</h3>
            <button type="button" class="modal-close" aria-label="关闭">×</button>
        </div>
        <div class="modal-body">
            <div class="modal-loading">准备加载项目详情…</div>
        </div>
    </div>
</div>

<!-- 签约弹窗 - 填写合同信息并分配项目负责人 -->
<div class="modal-overlay" id="contractSignModal" role="dialog" aria-modal="true" tabindex="-1" style="display:none;">
    <div class="modal-content" style="max-width: 1000px;">
        <div class="modal-header">
            <h3 class="modal-title">项目签约</h3>
            <button class="modal-close" type="button">×</button>
        </div>
        <div class="modal-body">
            <form id="contractSignForm">
                <!-- 项目基本信息（只读） -->
                <div class="form-section-title">项目基本信息</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>项目编号</label>
                        <input type="text" class="modal-input" id="signProjectNumber" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>项目名称</label>
                        <input type="text" class="modal-input" id="signProjectName" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>客户名称</label>
                        <input type="text" class="modal-input" id="signCustomerName" readonly style="background-color:#f5f5f5;">
                    </div>
                </div>
                
                <!-- 项目负责人和时间 - 签约时填写 -->
                <div class="form-section-title">项目负责人及计划时间<span class="required">*</span></div>
                <div class="form-row">
                    <div class="form-group">
                        <label>项目负责人<span class="required">*</span></label>
                        <select class="modal-input" id="signProjectManager" required>
                            <option value="">请选择项目负责人</option>
                            <option value="刘静">刘静</option>
                            <option value="王明">王明</option>
                            <option value="赵强">赵强</option>
                            <option value="孙伟">孙伟</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>计划开始日期<span class="required">*</span></label>
                        <input type="date" class="modal-input" id="signStartDate" required>
                    </div>
                    <div class="form-group">
                        <label>计划完工日期<span class="required">*</span></label>
                        <input type="date" class="modal-input" id="signEndDate" required>
                    </div>
                </div>
                
                <!-- 合同信息 -->
                <div class="form-section-title">合同信息<span class="required">*</span></div>
                <div class="form-row">
                    <div class="form-group">
                        <label>签订时间<span class="required">*</span></label>
                        <input type="date" class="modal-input" id="signDate" required>
                    </div>
                    <div class="form-group">
                        <label>合同类型<span class="required">*</span></label>
                        <select class="modal-input" id="contractType" required>
                            <option value="">请选择合同类型</option>
                            <option value="框架合同">框架合同</option>
                            <option value="设备采购合同">设备采购合同</option>
                            <option value="工程施工合同">工程施工合同</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>合同金额（万元）<span class="required">*</span></label>
                        <input type="number" step="0.01" class="modal-input" id="contractAmount" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>签订主体</label>
                        <input type="text" class="modal-input" id="signEntity" placeholder="如：河南平高电气股份有限公司">
                    </div>
                    <div class="form-group">
                        <label>合同编号</label>
                        <input type="text" class="modal-input" id="contractNumber" placeholder="合同编号">
                    </div>
                    <div class="form-group">
                        <label>产品型号</label>
                        <input type="text" class="modal-input" id="productModel">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>合同备注</label>
                        <textarea class="modal-input" id="contractRemark" rows="2" placeholder="请输入合同相关备注"></textarea>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-cancel">取消</button>
            <button type="button" class="modal-btn modal-btn-confirm">确认签约</button>
        </div>
    </div>
</div>

<!-- 分配实施人员弹窗 -->
<div class="modal-overlay" id="assignImplModal" role="dialog" aria-modal="true" tabindex="-1" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h3 class="modal-title">分配实施人员</h3>
            <button class="modal-close" type="button">×</button>
        </div>
        <div class="modal-body">
            <form id="assignImplForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>项目编号</label>
                        <input type="text" class="modal-input" id="assignProjectNumber" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>项目名称</label>
                        <input type="text" class="modal-input" id="assignProjectName" readonly style="background-color:#f5f5f5;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>实施负责人<span class="required">*</span></label>
                        <select class="modal-input" id="implManager" required>
                            <option value="">请选择实施负责人</option>
                            <option value="张三">张三</option>
                            <option value="李四">李四</option>
                            <option value="王五">王五</option>
                            <option value="赵六">赵六</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>实施团队人数</label>
                        <input type="number" class="modal-input" id="teamSize" min="1" placeholder="如：5">
                    </div>
                    <div class="form-group">
                        <label>预计开工时间</label>
                        <input type="date" class="modal-input" id="planStartDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>实施备注</label>
                        <textarea class="modal-input" id="implAssignRemark" rows="2" placeholder="请输入实施安排相关备注"></textarea>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-cancel">取消</button>
            <button type="button" class="modal-btn modal-btn-confirm">确认分配</button>
        </div>
    </div>
</div>

<!-- 验收登记弹窗 -->
<div class="modal-overlay" id="acceptanceModal" role="dialog" aria-modal="true" tabindex="-1" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 class="modal-title">验收登记</h3>
            <button class="modal-close" type="button">×</button>
        </div>
        <div class="modal-body">
            <form id="acceptanceForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>项目编号</label>
                        <input type="text" class="modal-input" id="acceptProjectNumber" readonly style="background-color:#f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>项目名称</label>
                        <input type="text" class="modal-input" id="acceptProjectName" readonly style="background-color:#f5f5f5;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>验收时间<span class="required">*</span></label>
                        <input type="date" class="modal-input" id="acceptanceDate" required>
                    </div>
                    <div class="form-group">
                        <label>验收人<span class="required">*</span></label>
                        <input type="text" class="modal-input" id="acceptancePerson" required>
                    </div>
                    <div class="form-group">
                        <label>验收结果<span class="required">*</span></label>
                        <select class="modal-input" id="acceptanceResult" required>
                            <option value="">请选择</option>
                            <option value="合格">合格</option>
                            <option value="不合格">不合格</option>
                            <option value="整改后合格">整改后合格</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>质保期</label>
                        <input type="text" class="modal-input" id="warrantyPeriod" placeholder="如：1年、2年">
                    </div>
                    <div class="form-group">
                        <label>质保开始日期</label>
                        <input type="date" class="modal-input" id="warrantyStartDate">
                    </div>
                    <div class="form-group">
                        <label>质保结束日期</label>
                        <input type="date" class="modal-input" id="warrantyEndDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>验收说明</label>
                        <textarea class="modal-input" id="acceptanceRemark" rows="3" placeholder="请输入验收相关说明"></textarea>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-cancel">取消</button>
            <button type="button" class="modal-btn modal-btn-confirm">确认验收</button>
        </div>
    </div>
</div>

<script>
// 项目管理相关函数
(function() {
    'use strict';
    
    // 查询项目
    window.queryProjects = function() {
        const projectName = document.getElementById('filterProjectName')?.value || '';
        const customerName = document.getElementById('filterCustomerName')?.value || '';
        const stage = document.getElementById('filterProjectStage')?.value || '';
        const salesman = document.getElementById('filterSalesman')?.value || '';
        
        console.log('查询条件：', { projectName, customerName, stage, salesman });
        alert('查询功能开发中...');
    };
    
    // 重置筛选条件
    window.resetFilters = function() {
        document.getElementById('filterProjectName').value = '';
        document.getElementById('filterCustomerName').value = '';
        document.getElementById('filterProjectStage').value = '';
        document.getElementById('filterSalesman').value = '';
    };
    
    // 切换筛选器展开/收起
    window.toggleFilters = function() {
        const filters = document.querySelector('.search-filters');
        filters?.classList.toggle('expanded');
    };
    
    // 全选/取消全选
    window.toggleSelectAll = function(checkbox) {
        const checkboxes = document.querySelectorAll('.row-checkbox');
        checkboxes.forEach(cb => cb.checked = checkbox.checked);
    };
    
    // 批量删除
    window.batchDeleteProjects = function() {
        const checked = document.querySelectorAll('.row-checkbox:checked');
        if (checked.length === 0) {
            alert('请选择要删除的项目');
            return;
        }
        if (confirm(`确定要删除选中的 ${checked.length} 个项目吗？`)) {
            alert('删除功能开发中...');
        }
    };
    
    // 导出项目
    window.exportProjects = function() {
        alert('导出功能开发中...');
    };
    
    // 查看项目详情
    window.viewProjectDetail = function(id) {
        console.log('查看项目详情：', id);
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return;
        
        // 调用 page-init.js 中的详情模态框函数
        if (typeof openProjectDetailModal === 'function') {
            const detailLink = row.querySelector('.action-link');
            if (detailLink) {
                detailLink.setAttribute('data-detail-page', 'pages/detail-project.html');
                openProjectDetailModal(detailLink);
            }
        }
    };
    
    // 查看项目档案（完整信息）
    window.viewProjectArchive = function(id) {
        console.log('查看项目档案：', id);
        window.loadPage('pages/project-archive.html', {id: id});
    };
    
    // 更新项目阶段
    window.updateStage = function(id, newStage) {
        console.log('更新项目阶段：', id, newStage);
        if (confirm(`确定要将项目转为"${newStage}"阶段吗？`)) {
            alert('项目阶段已更新');
            // 这里应该调用后端API更新
        }
    };
    
    // 打开签约弹窗
    window.openContractModal = function(id) {
        console.log('打开签约弹窗：', id);
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return;
        
        const modal = document.getElementById('contractSignModal');
        if (!modal) return;
        
        // 填充项目基本信息
        document.getElementById('signProjectNumber').value = row.cells[2]?.textContent || '';
        document.getElementById('signProjectName').value = row.cells[3]?.textContent || '';
        document.getElementById('signCustomerName').value = row.cells[4]?.textContent || '';
        
        // 设置默认签订时间为今天
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('signDate').value = today;
        
        modal.dataset.projectId = id;
        modal.style.display = 'flex';
    };
    
    // 查看合同详情
    window.viewContractDetail = function(id) {
        console.log('查看合同详情：', id);
        alert('合同详情查看功能开发中...');
    };
    
    // 分配实施人员
    window.assignImplementation = function(id) {
        console.log('分配实施人员：', id);
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return;
        
        const modal = document.getElementById('assignImplModal');
        if (!modal) return;
        
        document.getElementById('assignProjectNumber').value = row.cells[2]?.textContent || '';
        document.getElementById('assignProjectName').value = row.cells[3]?.textContent || '';
        
        modal.dataset.projectId = id;
        modal.style.display = 'flex';
    };
    
    // 编辑实施信息
    window.editImplementation = function(id) {
        console.log('编辑实施信息：', id);
        alert('打开实施信息编辑页面...');
    };
    
    // 查看实施进度
    window.viewImplementationProgress = function(id) {
        console.log('查看实施进度：', id);
        alert('查看实施进度功能开发中...');
    };
    
    // 打开验收登记弹窗
    window.openAcceptanceModal = function(id) {
        console.log('打开验收登记弹窗：', id);
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return;
        
        const modal = document.getElementById('acceptanceModal');
        if (!modal) return;
        
        document.getElementById('acceptProjectNumber').value = row.cells[2]?.textContent || '';
        document.getElementById('acceptProjectName').value = row.cells[3]?.textContent || '';
        
        // 设置默认验收时间为今天
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('acceptanceDate').value = today;
        
        modal.dataset.projectId = id;
        modal.style.display = 'flex';
    };
    
    // 下载验收报告
    window.downloadAcceptanceReport = function(id) {
        console.log('下载验收报告：', id);
        alert('验收报告下载功能开发中...');
    };
    
    // 弹窗关闭事件
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal-close')) {
            const modal = e.target.closest('.modal-overlay');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // 点击遮罩层关闭
        if (e.target.classList.contains('modal-overlay')) {
            e.target.style.display = 'none';
        }
        
        // 确定按钮
        if (e.target.classList.contains('modal-btn-confirm')) {
            const modal = e.target.closest('.modal-overlay');
            if (modal) {
                if (modal.id === 'contractSignModal') {
                    saveContractSign();
                } else if (modal.id === 'assignImplModal') {
                    saveImplAssignment();
                } else if (modal.id === 'acceptanceModal') {
                    saveAcceptance();
                }
            }
        }
        
        // 取消按钮
        if (e.target.classList.contains('modal-btn-cancel')) {
            const modal = e.target.closest('.modal-overlay');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    });
    
    // 保存签约信息
    function saveContractSign() {
        const modal = document.getElementById('contractSignModal');
        const projectId = modal?.dataset.projectId;
        
        const formData = {
            projectId: projectId,
            projectManager: document.getElementById('signProjectManager')?.value,
            startDate: document.getElementById('signStartDate')?.value,
            endDate: document.getElementById('signEndDate')?.value,
            signDate: document.getElementById('signDate')?.value,
            contractType: document.getElementById('contractType')?.value,
            contractAmount: document.getElementById('contractAmount')?.value,
            signEntity: document.getElementById('signEntity')?.value,
            contractNumber: document.getElementById('contractNumber')?.value,
            productModel: document.getElementById('productModel')?.value,
            contractRemark: document.getElementById('contractRemark')?.value
        };
        
        // 验证必填项
        if (!formData.projectManager || !formData.startDate || !formData.endDate || 
            !formData.signDate || !formData.contractType || !formData.contractAmount) {
            alert('请填写所有必填项');
            return;
        }
        
        console.log('保存签约信息：', formData);
        alert('签约成功！项目已进入"已签约"阶段');
        modal.style.display = 'none';
        
        // 更新表格显示
        const row = document.querySelector(`tr[data-id="${projectId}"]`);
        if (row) {
            row.cells[7].textContent = formData.projectManager;
            row.cells[8].innerHTML = '<span class="status-badge status-signed">已签约</span>';
            row.setAttribute('data-stage', '已签约');
        }
    }
    
    // 保存实施人员分配
    function saveImplAssignment() {
        const modal = document.getElementById('assignImplModal');
        const projectId = modal?.dataset.projectId;
        
        const formData = {
            projectId: projectId,
            implManager: document.getElementById('implManager')?.value,
            teamSize: document.getElementById('teamSize')?.value,
            planStartDate: document.getElementById('planStartDate')?.value,
            implAssignRemark: document.getElementById('implAssignRemark')?.value
        };
        
        if (!formData.implManager) {
            alert('请选择实施负责人');
            return;
        }
        
        console.log('保存实施人员分配：', formData);
        alert('实施人员分配成功！');
        modal.style.display = 'none';
        
        // 更新表格显示
        const row = document.querySelector(`tr[data-id="${projectId}"]`);
        if (row) {
            row.cells[8].innerHTML = '<span class="status-badge status-prepare">实施准备</span>';
            row.setAttribute('data-stage', '实施准备');
        }
    }
    
    // 保存验收信息
    function saveAcceptance() {
        const modal = document.getElementById('acceptanceModal');
        const projectId = modal?.dataset.projectId;
        
        const formData = {
            projectId: projectId,
            acceptanceDate: document.getElementById('acceptanceDate')?.value,
            acceptancePerson: document.getElementById('acceptancePerson')?.value,
            acceptanceResult: document.getElementById('acceptanceResult')?.value,
            warrantyPeriod: document.getElementById('warrantyPeriod')?.value,
            warrantyStartDate: document.getElementById('warrantyStartDate')?.value,
            warrantyEndDate: document.getElementById('warrantyEndDate')?.value,
            acceptanceRemark: document.getElementById('acceptanceRemark')?.value
        };
        
        if (!formData.acceptanceDate || !formData.acceptancePerson || !formData.acceptanceResult) {
            alert('请填写所有必填项');
            return;
        }
        
        console.log('保存验收信息：', formData);
        alert('验收登记成功！');
        modal.style.display = 'none';
        
        // 更新表格显示
        const row = document.querySelector(`tr[data-id="${projectId}"]`);
        if (row) {
            row.cells[8].innerHTML = '<span class="status-badge status-acceptance">已验收</span>';
            row.setAttribute('data-stage', '已验收');
        }
    }
})();
</script>
