<!-- æ ‡ç­¾é¡µ -->
<div class="tabs">
    <div class="tab active">
        æ–°å¢é¡¹ç›®çº¿ç´¢
        <span class="tab-close">Ã—</span>
    </div>
</div>

<!-- æ“ä½œæ  -->
<div class="action-bar">
    <div class="action-left">
        <button class="btn-back" onclick="window.loadPage('pages/project-info.html')">â† è¿”å›</button>
        <span class="page-title">æ–°å¢é¡¹ç›®çº¿ç´¢</span>
    </div>
    <div class="action-right">
        <button class="btn-confirm" onclick="saveProjectLead()">ä¿å­˜</button>
        <button class="btn-cancel" onclick="window.loadPage('pages/project-info.html')">å–æ¶ˆ</button>
    </div>
</div>

<!-- é¡¹ç›®çº¿ç´¢è¡¨å• -->
<div class="form-container">
    <div class="form-header-tip">
        <span class="tip-icon">â„¹ï¸</span>
        <span class="tip-text">å¸‚åœºçº¿ç´¢é˜¶æ®µä»…éœ€å¡«å†™é¡¹ç›®åŸºæœ¬ä¿¡æ¯ï¼Œç­¾çº¦åç³»ç»Ÿä¼šè¦æ±‚è¡¥å……é¡¹ç›®è´Ÿè´£äººã€åˆåŒä¿¡æ¯ç­‰è¯¦ç»†èµ„æ–™</span>
    </div>
    
    <h2 class="form-title">é¡¹ç›®åŸºæœ¬ä¿¡æ¯</h2>
    <form class="project-form" id="projectLeadForm">
        <!-- ç¬¬ä¸€è¡Œ -->
        <div class="form-row">
            <div class="form-group required">
                <label>é¡¹ç›®ç¼–å·</label>
                <input type="text" id="projectNumber" readonly style="background-color: #f5f5f5;">
                <span class="form-tip">ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼ŒPLè¡¨ç¤ºProject Leadï¼ˆé¡¹ç›®çº¿ç´¢ï¼‰</span>
            </div>
            <div class="form-group required">
                <label>å®¢æˆ·åç§°</label>
                <select id="customerName" required>
                    <option value="">è¯·é€‰æ‹©æˆ–æœç´¢å®¢æˆ·</option>
                    <option value="æ²™ä¿„æœ‰é™å…¬å¸">æ²™ä¿„æœ‰é™å…¬å¸</option>
                    <option value="æ­£å¤§åŒ–å·¥æœ‰é™å…¬å¸">æ­£å¤§åŒ–å·¥æœ‰é™å…¬å¸</option>
                    <option value="æ–°ç–†æ˜Œå‰æ–°èƒ½æºæœ‰é™å…¬å¸">æ–°ç–†æ˜Œå‰æ–°èƒ½æºæœ‰é™å…¬å¸</option>
                    <option value="æ­¦æ±‰è¿ˆç‘åŒ»ç–—è®¾å¤‡æœ‰é™å…¬å¸">æ­¦æ±‰è¿ˆç‘åŒ»ç–—è®¾å¤‡æœ‰é™å…¬å¸</option>
                    <option value="å¹³é¡¶å±±å°¼é¾™äº§ä¸šå›­ç®¡ç†æœ‰é™å…¬å¸">å¹³é¡¶å±±å°¼é¾™äº§ä¸šå›­ç®¡ç†æœ‰é™å…¬å¸</option>
                    <option value="other">+ æ–°å¢å®¢æˆ·</option>
                </select>
            </div>
            <div class="form-group required">
                <label>é¡¹ç›®åç§°</label>
                <input type="text" id="projectName" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°" required>
            </div>
        </div>

        <!-- ç¬¬äºŒè¡Œ -->
        <div class="form-row">
            <div class="form-group required">
                <label>é¡¹ç›®æ‰€åœ¨åœ°ï¼ˆçœ/å¸‚ï¼‰</label>
                <input type="text" id="projectLocation" placeholder="è¯·è¾“å…¥çœå¸‚ï¼Œå¦‚ï¼šæ²³å—çœéƒ‘å·å¸‚" required>
            </div>
            <div class="form-group">
                <label>è¯¦ç»†åœ°å€</label>
                <input type="text" id="detailedAddress" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€">
            </div>
        </div>

        <!-- ç¬¬ä¸‰è¡Œ -->
        <div class="form-row">
            <div class="form-group required">
                <label>å¸‚åœºäººå‘˜</label>
                <select id="salesman" required>
                    <option value="">è¯·é€‰æ‹©å¸‚åœºäººå‘˜</option>
                    <option value="ææ˜">ææ˜</option>
                    <option value="ç‹èŠ³">ç‹èŠ³</option>
                    <option value="å¼ ä¼Ÿ">å¼ ä¼Ÿ</option>
                    <option value="åˆ˜é™">åˆ˜é™</option>
                    <option value="å­™ä¼Ÿ">å­™ä¼Ÿ</option>
                </select>
                <span class="form-tip">è´Ÿè´£è·Ÿè¿›æ­¤é¡¹ç›®çš„å¸‚åœºäººå‘˜</span>
            </div>
            <div class="form-group">
                <label>å®¢æˆ·è”ç³»äºº</label>
                <input type="text" id="contactPerson" placeholder="è¯·è¾“å…¥å®¢æˆ·è”ç³»äºº">
            </div>
            <div class="form-group">
                <label>è”ç³»ç”µè¯</label>
                <input type="text" id="contactPhone" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯" pattern="[0-9\-]+">
            </div>
        </div>

        <!-- ç¬¬å››è¡Œ -->
        <div class="form-row">
            <div class="form-group">
                <label>çº¿ç´¢æ¥æº</label>
                <select id="leadSource">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å®¢æˆ·æ¨è">å®¢æˆ·æ¨è</option>
                    <option value="å±•ä¼š">å±•ä¼š</option>
                    <option value="ç½‘ç»œè¥é”€">ç½‘ç»œè¥é”€</option>
                    <option value="ç”µè¯è¥é”€">ç”µè¯è¥é”€</option>
                    <option value="åˆä½œä¼™ä¼´">åˆä½œä¼™ä¼´</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label>é¢„è®¡ç­¾çº¦æ—¶é—´</label>
                <input type="month" id="expectedSignMonth" placeholder="è¯·é€‰æ‹©é¢„è®¡ç­¾çº¦æœˆä»½">
                <span class="form-tip">é€‰å¡«ï¼Œç”¨äºé”€å”®é¢„æµ‹</span>
            </div>
            <div class="form-group">
                <label>çº¿ç´¢ä¼˜å…ˆçº§</label>
                <select id="priority">
                    <option value="ä¸­">ä¸­</option>
                    <option value="é«˜">é«˜</option>
                    <option value="ä½">ä½</option>
                </select>
            </div>
        </div>

        <!-- ç¬¬äº”è¡Œ -->
        <div class="form-row">
            <div class="form-group full-width">
                <label>é¡¹ç›®éœ€æ±‚æè¿°</label>
                <textarea id="projectDescription" rows="3" placeholder="è¯·ç®€è¦æè¿°å®¢æˆ·çš„é¡¹ç›®éœ€æ±‚ã€ç—›ç‚¹ã€æœŸæœ›ç­‰ä¿¡æ¯"></textarea>
            </div>
        </div>
        
        <!-- ç¬¬å…­è¡Œ -->
        <div class="form-row">
            <div class="form-group full-width">
                <label>å¤‡æ³¨</label>
                <textarea id="remark" rows="2" placeholder="å…¶ä»–å¤‡æ³¨ä¿¡æ¯"></textarea>
            </div>
        </div>
    </form>
    
    <div class="form-footer-tip">
        <span class="tip-icon">ğŸ’¡</span>
        <span class="tip-text"><strong>æç¤ºï¼š</strong>é¡¹ç›®è´Ÿè´£äººã€é¡¹ç›®æ—¶é—´ã€åˆåŒä¿¡æ¯ç­‰å°†åœ¨ç­¾çº¦ç¯èŠ‚è¡¥å……ï¼Œå½“å‰é˜¶æ®µæ— éœ€å¡«å†™</span>
    </div>
</div>

<script>
// æ–°å¢é¡¹ç›®çº¿ç´¢åŠŸèƒ½
(function() {
    'use strict';
    
    // è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®ç¼–å·ï¼ˆçº¿ç´¢ç¼–å·ï¼‰
    function generateProjectNumber() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const random = String(Math.floor(Math.random() * 100)).padStart(2, '0');
        return `PL${year}-${month}-${day}${random}`;  // PL = Project Lead
    }
    
    // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆé¡¹ç›®ç¼–å·
    document.addEventListener('DOMContentLoaded', function() {
        const projectNumberInput = document.getElementById('projectNumber');
        if (projectNumberInput && !projectNumberInput.value) {
            projectNumberInput.value = generateProjectNumber();
        }
        
        // é»˜è®¤é€‰ä¸­å½“å‰ç”¨æˆ·ä¸ºå¸‚åœºäººå‘˜ï¼ˆå®é™…åº”è¯¥ä»ç™»å½•ä¿¡æ¯è·å–ï¼‰
        const salesmanSelect = document.getElementById('salesman');
        if (salesmanSelect) {
            // è¿™é‡Œå¯ä»¥è®¾ç½®é»˜è®¤å€¼
            // salesmanSelect.value = 'å½“å‰ç™»å½•ç”¨æˆ·';
        }
    });
    
    // å®¢æˆ·é€‰æ‹©å˜åŒ–
    document.getElementById('customerName')?.addEventListener('change', function() {
        if (this.value === 'other') {
            const newCustomer = prompt('è¯·è¾“å…¥æ–°å®¢æˆ·åç§°ï¼š');
            if (newCustomer) {
                const option = document.createElement('option');
                option.value = newCustomer;
                option.textContent = newCustomer;
                option.selected = true;
                this.insertBefore(option, this.lastElementChild);
            } else {
                this.value = '';
            }
        }
    });
    
    // ä¿å­˜é¡¹ç›®çº¿ç´¢
    window.saveProjectLead = function() {
        const form = document.getElementById('projectLeadForm');
        if (!form) return;
        
        // éªŒè¯å¿…å¡«é¡¹
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        let firstInvalidField = null;
        
        requiredFields.forEach(field => {
            if (!field.value || field.value.trim() === '') {
                isValid = false;
                field.style.borderColor = '#ff4d4f';
                if (!firstInvalidField) {
                    firstInvalidField = field;
                }
            } else {
                field.style.borderColor = '';
            }
        });
        
        if (!isValid) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼ˆæ ‡æ³¨*å·çš„å­—æ®µï¼‰');
            if (firstInvalidField) {
                firstInvalidField.focus();
            }
            return;
        }
        
        // æ”¶é›†è¡¨å•æ•°æ®
        const formData = {
            projectNumber: document.getElementById('projectNumber')?.value,
            customerName: document.getElementById('customerName')?.value,
            projectName: document.getElementById('projectName')?.value,
            projectLocation: document.getElementById('projectLocation')?.value,
            detailedAddress: document.getElementById('detailedAddress')?.value,
            salesman: document.getElementById('salesman')?.value,
            contactPerson: document.getElementById('contactPerson')?.value,
            contactPhone: document.getElementById('contactPhone')?.value,
            leadSource: document.getElementById('leadSource')?.value,
            expectedSignMonth: document.getElementById('expectedSignMonth')?.value,
            priority: document.getElementById('priority')?.value,
            projectDescription: document.getElementById('projectDescription')?.value,
            remark: document.getElementById('remark')?.value,
            stage: 'å¸‚åœºçº¿ç´¢',  // é»˜è®¤é˜¶æ®µ
            createTime: new Date().toISOString().split('T')[0]
        };
        
        console.log('ä¿å­˜é¡¹ç›®çº¿ç´¢æ•°æ®ï¼š', formData);
        
        // è¿™é‡Œåº”è¯¥å‘é€åˆ°åç«¯API
        // fetch('/api/projects/leads', { method: 'POST', body: JSON.stringify(formData) })
        
        alert('é¡¹ç›®çº¿ç´¢å·²åˆ›å»ºï¼\n\n' + 
              'é¡¹ç›®ç¼–å·ï¼š' + formData.projectNumber + '\n' +
              'å½“å‰é˜¶æ®µï¼šå¸‚åœºçº¿ç´¢\n\n' +
              'åç»­å¯é€šè¿‡"å•†æœºè·Ÿè¿›"æ¨è¿›é¡¹ç›®ï¼Œç­¾çº¦æ—¶ç³»ç»Ÿå°†è¦æ±‚è¡¥å……é¡¹ç›®è´Ÿè´£äººå’ŒåˆåŒä¿¡æ¯ã€‚');
        
        window.loadPage('pages/project-info.html');
    };
    
    // å®æ—¶éªŒè¯å¿…å¡«é¡¹
    document.addEventListener('input', function(e) {
        if (e.target.hasAttribute('required') && e.target.value) {
            e.target.style.borderColor = '';
        }
    });
    
    // ç”µè¯å·ç æ ¼å¼éªŒè¯
    document.getElementById('contactPhone')?.addEventListener('blur', function() {
        if (this.value && !this.checkValidity()) {
            alert('è¯·è¾“å…¥æ­£ç¡®çš„ç”µè¯å·ç æ ¼å¼');
            this.focus();
        }
    });
})();
</script>
